<<<<<<< HEAD
{"version":3,"file":"withIosSplashAssets.js","names":["_configPlugins","data","require","_imageUtils","_debug","_interopRequireDefault","_fsExtra","_jimpCompact","path","_interopRequireWildcard","_AssetContents","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","debug","Debug","IMAGE_CACHE_NAME","IMAGESET_PATH","BACKGROUND_IMAGESET_PATH","PNG_FILENAME","DARK_PNG_FILENAME","TABLET_PNG_FILENAME","DARK_TABLET_PNG_FILENAME","withIosSplashAssets","config","splash","withDangerousMod","iosNamedProjectRoot","IOSConfig","Paths","getSourceRoot","modRequest","projectRoot","createSplashScreenBackgroundImageAsync","configureImageAssets","image","darkImage","dark","tabletImage","darkTabletImage","exports","imageSetPath","resolve","fs","remove","writeContentsJsonFileAsync","assetPath","copyImageFiles","createPngFileAsync","color","filePath","png","Jimp","writeAsync","createBackgroundImagesAsync","darkColor","tabletColor","darkTabletColor","generateImagesAssetsAsync","generateImageAsset","item","fileName","anyItem","darkItem","tabletItem","darkTabletItem","source","generateImageAsync","cacheType","src","writeFile","items","filter","Promise","all","map","backgroundColor","tabletBackgroundColor","imagesetPath","join","ensureDir","darkAppearances","appearance","value","buildContentsJsonImages","createContentsJsonItem","idiom","filename","scale","appearances","undefined","Boolean","images","writeContentsJsonAsync"],"sources":["../../../../src/plugins/unversioned/expo-splash-screen/withIosSplashAssets.ts"],"sourcesContent":["import { ConfigPlugin, IOSConfig, withDangerousMod } from '@expo/config-plugins';\nimport { generateImageAsync } from '@expo/image-utils';\nimport Debug from 'debug';\nimport fs from 'fs-extra';\n// @ts-ignore\nimport Jimp from 'jimp-compact';\nimport * as path from 'path';\n\nimport { IOSSplashConfig } from './getIosSplashConfig';\nimport {\n  ContentsJsonImage,\n  ContentsJsonImageAppearance,\n  createContentsJsonItem,\n  writeContentsJsonAsync,\n} from '../../icons/AssetContents';\n\nconst debug = Debug('expo:prebuild-config:expo-splash-screen:ios:assets');\n\nconst IMAGE_CACHE_NAME = 'splash-ios';\nconst IMAGESET_PATH = 'Images.xcassets/SplashScreen.imageset';\nconst BACKGROUND_IMAGESET_PATH = 'Images.xcassets/SplashScreenBackground.imageset';\nconst PNG_FILENAME = 'image.png';\nconst DARK_PNG_FILENAME = 'dark_image.png';\nconst TABLET_PNG_FILENAME = 'tablet_image.png';\nconst DARK_TABLET_PNG_FILENAME = 'dark_tablet_image.png';\n\nexport const withIosSplashAssets: ConfigPlugin<IOSSplashConfig> = (config, splash) => {\n  if (!splash) {\n    return config;\n  }\n  return withDangerousMod(config, [\n    'ios',\n    async (config) => {\n      const iosNamedProjectRoot = IOSConfig.Paths.getSourceRoot(config.modRequest.projectRoot);\n\n      await createSplashScreenBackgroundImageAsync({\n        iosNamedProjectRoot,\n        splash,\n      });\n\n      await configureImageAssets({\n        projectRoot: config.modRequest.projectRoot,\n        iosNamedProjectRoot,\n        image: splash.image,\n        darkImage: splash.dark?.image,\n        tabletImage: splash.tabletImage,\n        darkTabletImage: splash.dark?.tabletImage,\n      });\n\n      return config;\n    },\n  ]);\n};\n\n/**\n * Creates imageset containing image for Splash/Launch Screen.\n */\nasync function configureImageAssets({\n  projectRoot,\n  iosNamedProjectRoot,\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  projectRoot: string;\n  iosNamedProjectRoot: string;\n  image?: string | null;\n  darkImage?: string | null;\n  tabletImage: string | null;\n  darkTabletImage?: string | null;\n}) {\n  const imageSetPath = path.resolve(iosNamedProjectRoot, IMAGESET_PATH);\n\n  // ensure old SplashScreen imageSet is removed\n  await fs.remove(imageSetPath);\n\n  if (!image) {\n    return;\n  }\n\n  await writeContentsJsonFileAsync({\n    assetPath: imageSetPath,\n    image: PNG_FILENAME,\n    darkImage: darkImage ? DARK_PNG_FILENAME : null,\n    tabletImage: tabletImage ? TABLET_PNG_FILENAME : null,\n    darkTabletImage: darkTabletImage ? DARK_TABLET_PNG_FILENAME : null,\n  });\n\n  await copyImageFiles({\n    projectRoot,\n    iosNamedProjectRoot,\n    image,\n    darkImage,\n    tabletImage,\n    darkTabletImage,\n  });\n}\n\nasync function createPngFileAsync(color: string, filePath: string) {\n  const png = new Jimp(1, 1, color);\n  return png.writeAsync(filePath);\n}\n\nasync function createBackgroundImagesAsync({\n  iosNamedProjectRoot,\n  color,\n  darkColor,\n  tabletColor,\n  darkTabletColor,\n}: {\n  iosNamedProjectRoot: string;\n  color: string;\n  darkColor: string | null;\n  tabletColor: string | null;\n  darkTabletColor: string | null;\n}) {\n  await generateImagesAssetsAsync({\n    async generateImageAsset(item, fileName) {\n      await createPngFileAsync(\n        item,\n        path.resolve(iosNamedProjectRoot, BACKGROUND_IMAGESET_PATH, fileName)\n      );\n    },\n    anyItem: color,\n    darkItem: darkColor,\n    tabletItem: tabletColor,\n    darkTabletItem: darkTabletColor,\n  });\n}\n\nasync function copyImageFiles({\n  projectRoot,\n  iosNamedProjectRoot,\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  projectRoot: string;\n  iosNamedProjectRoot: string;\n  image: string;\n  darkImage?: string | null;\n  tabletImage?: string | null;\n  darkTabletImage?: string | null;\n}) {\n  await generateImagesAssetsAsync({\n    async generateImageAsset(item, fileName) {\n      // Using this method will cache the images in `.expo` based on the properties used to generate them.\n      // this method also supports remote URLs and using the global sharp instance.\n      const { source } = await generateImageAsync({ projectRoot, cacheType: IMAGE_CACHE_NAME }, {\n        src: item,\n      } as any);\n      // Write image buffer to the file system.\n      // const assetPath = join(iosNamedProjectRoot, IMAGESET_PATH, filename);\n      await fs.writeFile(path.resolve(iosNamedProjectRoot, IMAGESET_PATH, fileName), source);\n    },\n    anyItem: image,\n    darkItem: darkImage,\n    tabletItem: tabletImage,\n    darkTabletItem: darkTabletImage,\n  });\n}\n\nasync function generateImagesAssetsAsync({\n  generateImageAsset,\n  anyItem,\n  darkItem,\n  tabletItem,\n  darkTabletItem,\n}: {\n  generateImageAsset: (item: string, fileName: string) => Promise<void>;\n  anyItem: string;\n  darkItem?: string | null;\n  tabletItem?: string | null;\n  darkTabletItem?: string | null;\n}) {\n  const items = [\n    [anyItem, PNG_FILENAME],\n    [darkItem, DARK_PNG_FILENAME],\n    [tabletItem, TABLET_PNG_FILENAME],\n    [darkTabletItem, DARK_TABLET_PNG_FILENAME],\n  ].filter(([item]) => !!item) as unknown as [string, string];\n\n  await Promise.all(items.map(([item, fileName]) => generateImageAsset(item, fileName)));\n}\n\nasync function createSplashScreenBackgroundImageAsync({\n  iosNamedProjectRoot,\n  splash,\n}: {\n  // Something like projectRoot/ios/MyApp/\n  iosNamedProjectRoot: string;\n  splash: IOSSplashConfig;\n}) {\n  const color = splash.backgroundColor;\n  const darkColor = splash.dark?.backgroundColor;\n  const tabletColor = splash.tabletBackgroundColor;\n  const darkTabletColor = splash.dark?.tabletBackgroundColor;\n\n  const imagesetPath = path.join(iosNamedProjectRoot, BACKGROUND_IMAGESET_PATH);\n  // Ensure the Images.xcassets/... path exists\n  await fs.remove(imagesetPath);\n  await fs.ensureDir(imagesetPath);\n\n  await createBackgroundImagesAsync({\n    iosNamedProjectRoot,\n    color,\n    darkColor: darkColor ? darkColor : null,\n    tabletColor: tabletColor ? tabletColor : null,\n    darkTabletColor: darkTabletColor ? darkTabletColor : null,\n  });\n\n  await writeContentsJsonFileAsync({\n    assetPath: path.resolve(iosNamedProjectRoot, BACKGROUND_IMAGESET_PATH),\n    image: PNG_FILENAME,\n    darkImage: darkColor ? DARK_PNG_FILENAME : null,\n    tabletImage: tabletColor ? TABLET_PNG_FILENAME : null,\n    darkTabletImage: darkTabletColor ? DARK_TABLET_PNG_FILENAME : null,\n  });\n}\n\nconst darkAppearances: ContentsJsonImageAppearance[] = [\n  {\n    appearance: 'luminosity',\n    value: 'dark',\n  } as ContentsJsonImageAppearance,\n];\n\nexport function buildContentsJsonImages({\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  image: string;\n  tabletImage: string | null;\n  darkImage: string | null;\n  darkTabletImage: string | null;\n}): ContentsJsonImage[] {\n  return [\n    // Phone light\n    createContentsJsonItem({\n      idiom: 'universal',\n      filename: image,\n      scale: '1x',\n    }),\n    createContentsJsonItem({\n      idiom: 'universal',\n      scale: '2x',\n    }),\n    createContentsJsonItem({\n      idiom: 'universal',\n      scale: '3x',\n    }),\n    // Phone dark\n    darkImage &&\n      createContentsJsonItem({\n        idiom: 'universal',\n        appearances: darkAppearances,\n        filename: darkImage,\n        scale: '1x',\n      }),\n    darkImage &&\n      createContentsJsonItem({\n        idiom: 'universal',\n        appearances: darkAppearances,\n        scale: '2x',\n      }),\n    darkImage &&\n      createContentsJsonItem({\n        idiom: 'universal',\n        appearances: darkAppearances,\n        scale: '3x',\n      }),\n    // Tablet light\n    tabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        filename: tabletImage,\n        scale: '1x',\n      }),\n    tabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        scale: '2x',\n      }),\n    // Phone dark\n    darkTabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        appearances: darkAppearances,\n        filename: darkTabletImage ?? undefined,\n        scale: '1x',\n      }),\n    darkTabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        appearances: darkAppearances,\n        scale: '2x',\n      }),\n  ].filter(Boolean) as ContentsJsonImage[];\n}\n\nasync function writeContentsJsonFileAsync({\n  assetPath,\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  assetPath: string;\n  image: string;\n  darkImage: string | null;\n  tabletImage: string | null;\n  darkTabletImage: string | null;\n}) {\n  const images = buildContentsJsonImages({ image, darkImage, tabletImage, darkTabletImage });\n\n  debug(`create contents.json:`, assetPath);\n  debug(`use images:`, images);\n  await writeContentsJsonAsync(assetPath, { images });\n}\n"],"mappings":"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"}
=======
{"version":3,"sources":["../../../../src/plugins/unversioned/expo-splash-screen/withIosSplashAssets.ts"],"names":["debug","IMAGE_CACHE_NAME","IMAGESET_PATH","BACKGROUND_IMAGESET_PATH","PNG_FILENAME","DARK_PNG_FILENAME","TABLET_PNG_FILENAME","DARK_TABLET_PNG_FILENAME","withIosSplashAssets","config","splash","iosNamedProjectRoot","IOSConfig","Paths","getSourceRoot","modRequest","projectRoot","createSplashScreenBackgroundImageAsync","configureImageAssets","image","darkImage","dark","tabletImage","darkTabletImage","imageSetPath","path","resolve","fs","remove","writeContentsJsonFileAsync","assetPath","copyImageFiles","createPngFileAsync","color","filePath","png","Jimp","writeAsync","createBackgroundImagesAsync","darkColor","tabletColor","darkTabletColor","generateImagesAssetsAsync","generateImageAsset","item","fileName","anyItem","darkItem","tabletItem","darkTabletItem","source","cacheType","src","writeFile","items","filter","Promise","all","map","backgroundColor","tabletBackgroundColor","imagesetPath","join","ensureDir","darkAppearances","appearance","value","buildContentsJsonImages","idiom","filename","scale","appearances","undefined","Boolean","images"],"mappings":"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","sourcesContent":["import { ConfigPlugin, IOSConfig, withDangerousMod } from '@expo/config-plugins';\nimport { generateImageAsync } from '@expo/image-utils';\nimport Debug from 'debug';\nimport fs from 'fs-extra';\n// @ts-ignore\nimport Jimp from 'jimp-compact';\nimport * as path from 'path';\n\nimport {\n  ContentsJsonImage,\n  ContentsJsonImageAppearance,\n  createContentsJsonItem,\n  writeContentsJsonAsync,\n} from '../../icons/AssetContents';\nimport { IOSSplashConfig } from './getIosSplashConfig';\n\nconst debug = Debug('expo:prebuild-config:expo-splash-screen:ios:assets');\n\nconst IMAGE_CACHE_NAME = 'splash-ios';\nconst IMAGESET_PATH = 'Images.xcassets/SplashScreen.imageset';\nconst BACKGROUND_IMAGESET_PATH = 'Images.xcassets/SplashScreenBackground.imageset';\nconst PNG_FILENAME = 'image.png';\nconst DARK_PNG_FILENAME = 'dark_image.png';\nconst TABLET_PNG_FILENAME = 'tablet_image.png';\nconst DARK_TABLET_PNG_FILENAME = 'dark_tablet_image.png';\n\nexport const withIosSplashAssets: ConfigPlugin<IOSSplashConfig> = (config, splash) => {\n  if (!splash) {\n    return config;\n  }\n  return withDangerousMod(config, [\n    'ios',\n    async config => {\n      const iosNamedProjectRoot = IOSConfig.Paths.getSourceRoot(config.modRequest.projectRoot);\n\n      await createSplashScreenBackgroundImageAsync({\n        iosNamedProjectRoot,\n        splash,\n      });\n\n      await configureImageAssets({\n        projectRoot: config.modRequest.projectRoot,\n        iosNamedProjectRoot,\n        image: splash.image,\n        darkImage: splash.dark?.image,\n        tabletImage: splash.tabletImage,\n        darkTabletImage: splash.dark?.tabletImage,\n      });\n\n      return config;\n    },\n  ]);\n};\n\n/**\n * Creates imageset containing image for Splash/Launch Screen.\n */\nasync function configureImageAssets({\n  projectRoot,\n  iosNamedProjectRoot,\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  projectRoot: string;\n  iosNamedProjectRoot: string;\n  image?: string | null;\n  darkImage?: string | null;\n  tabletImage: string | null;\n  darkTabletImage?: string | null;\n}) {\n  const imageSetPath = path.resolve(iosNamedProjectRoot, IMAGESET_PATH);\n\n  // ensure old SplashScreen imageSet is removed\n  await fs.remove(imageSetPath);\n\n  if (!image) {\n    return;\n  }\n\n  await writeContentsJsonFileAsync({\n    assetPath: imageSetPath,\n    image: PNG_FILENAME,\n    darkImage: darkImage ? DARK_PNG_FILENAME : null,\n    tabletImage: tabletImage ? TABLET_PNG_FILENAME : null,\n    darkTabletImage: darkTabletImage ? DARK_TABLET_PNG_FILENAME : null,\n  });\n\n  await copyImageFiles({\n    projectRoot,\n    iosNamedProjectRoot,\n    image,\n    darkImage,\n    tabletImage,\n    darkTabletImage,\n  });\n}\n\nasync function createPngFileAsync(color: string, filePath: string) {\n  const png = new Jimp(1, 1, color);\n  return png.writeAsync(filePath);\n}\n\nasync function createBackgroundImagesAsync({\n  iosNamedProjectRoot,\n  color,\n  darkColor,\n  tabletColor,\n  darkTabletColor,\n}: {\n  iosNamedProjectRoot: string;\n  color: string;\n  darkColor: string | null;\n  tabletColor: string | null;\n  darkTabletColor: string | null;\n}) {\n  await generateImagesAssetsAsync({\n    async generateImageAsset(item, fileName) {\n      await createPngFileAsync(\n        item,\n        path.resolve(iosNamedProjectRoot, BACKGROUND_IMAGESET_PATH, fileName)\n      );\n    },\n    anyItem: color,\n    darkItem: darkColor,\n    tabletItem: tabletColor,\n    darkTabletItem: darkTabletColor,\n  });\n}\n\nasync function copyImageFiles({\n  projectRoot,\n  iosNamedProjectRoot,\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  projectRoot: string;\n  iosNamedProjectRoot: string;\n  image: string;\n  darkImage?: string | null;\n  tabletImage?: string | null;\n  darkTabletImage?: string | null;\n}) {\n  await generateImagesAssetsAsync({\n    async generateImageAsset(item, fileName) {\n      // Using this method will cache the images in `.expo` based on the properties used to generate them.\n      // this method also supports remote URLs and using the global sharp instance.\n      const { source } = await generateImageAsync({ projectRoot, cacheType: IMAGE_CACHE_NAME }, {\n        src: item,\n      } as any);\n      // Write image buffer to the file system.\n      // const assetPath = join(iosNamedProjectRoot, IMAGESET_PATH, filename);\n      await fs.writeFile(path.resolve(iosNamedProjectRoot, IMAGESET_PATH, fileName), source);\n    },\n    anyItem: image,\n    darkItem: darkImage,\n    tabletItem: tabletImage,\n    darkTabletItem: darkTabletImage,\n  });\n}\n\nasync function generateImagesAssetsAsync({\n  generateImageAsset,\n  anyItem,\n  darkItem,\n  tabletItem,\n  darkTabletItem,\n}: {\n  generateImageAsset: (item: string, fileName: string) => Promise<void>;\n  anyItem: string;\n  darkItem?: string | null;\n  tabletItem?: string | null;\n  darkTabletItem?: string | null;\n}) {\n  const items = ([\n    [anyItem, PNG_FILENAME],\n    [darkItem, DARK_PNG_FILENAME],\n    [tabletItem, TABLET_PNG_FILENAME],\n    [darkTabletItem, DARK_TABLET_PNG_FILENAME],\n  ].filter(([item]) => !!item) as unknown) as [string, string];\n\n  await Promise.all(items.map(([item, fileName]) => generateImageAsset(item, fileName)));\n}\n\nasync function createSplashScreenBackgroundImageAsync({\n  iosNamedProjectRoot,\n  splash,\n}: {\n  // Something like projectRoot/ios/MyApp/\n  iosNamedProjectRoot: string;\n  splash: IOSSplashConfig;\n}) {\n  const color = splash.backgroundColor;\n  const darkColor = splash.dark?.backgroundColor;\n  const tabletColor = splash.tabletBackgroundColor;\n  const darkTabletColor = splash.dark?.tabletBackgroundColor;\n\n  const imagesetPath = path.join(iosNamedProjectRoot, BACKGROUND_IMAGESET_PATH);\n  // Ensure the Images.xcassets/... path exists\n  await fs.remove(imagesetPath);\n  await fs.ensureDir(imagesetPath);\n\n  await createBackgroundImagesAsync({\n    iosNamedProjectRoot,\n    color,\n    darkColor: darkColor ? darkColor : null,\n    tabletColor: tabletColor ? tabletColor : null,\n    darkTabletColor: darkTabletColor ? darkTabletColor : null,\n  });\n\n  await writeContentsJsonFileAsync({\n    assetPath: path.resolve(iosNamedProjectRoot, BACKGROUND_IMAGESET_PATH),\n    image: PNG_FILENAME,\n    darkImage: darkColor ? DARK_PNG_FILENAME : null,\n    tabletImage: tabletColor ? TABLET_PNG_FILENAME : null,\n    darkTabletImage: darkTabletColor ? DARK_TABLET_PNG_FILENAME : null,\n  });\n}\n\nconst darkAppearances: ContentsJsonImageAppearance[] = [\n  {\n    appearance: 'luminosity',\n    value: 'dark',\n  } as ContentsJsonImageAppearance,\n];\n\nexport function buildContentsJsonImages({\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  image: string;\n  tabletImage: string | null;\n  darkImage: string | null;\n  darkTabletImage: string | null;\n}): ContentsJsonImage[] {\n  return [\n    // Phone light\n    createContentsJsonItem({\n      idiom: 'universal',\n      filename: image,\n      scale: '1x',\n    }),\n    createContentsJsonItem({\n      idiom: 'universal',\n      scale: '2x',\n    }),\n    createContentsJsonItem({\n      idiom: 'universal',\n      scale: '3x',\n    }),\n    // Phone dark\n    darkImage &&\n      createContentsJsonItem({\n        idiom: 'universal',\n        appearances: darkAppearances,\n        filename: darkImage,\n        scale: '1x',\n      }),\n    darkImage &&\n      createContentsJsonItem({\n        idiom: 'universal',\n        appearances: darkAppearances,\n        scale: '2x',\n      }),\n    darkImage &&\n      createContentsJsonItem({\n        idiom: 'universal',\n        appearances: darkAppearances,\n        scale: '3x',\n      }),\n    // Tablet light\n    tabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        filename: tabletImage,\n        scale: '1x',\n      }),\n    tabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        scale: '2x',\n      }),\n    // Phone dark\n    darkTabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        appearances: darkAppearances,\n        filename: darkTabletImage ?? undefined,\n        scale: '1x',\n      }),\n    darkTabletImage &&\n      createContentsJsonItem({\n        idiom: 'ipad',\n        appearances: darkAppearances,\n        scale: '2x',\n      }),\n  ].filter(Boolean) as ContentsJsonImage[];\n}\n\nasync function writeContentsJsonFileAsync({\n  assetPath,\n  image,\n  darkImage,\n  tabletImage,\n  darkTabletImage,\n}: {\n  assetPath: string;\n  image: string;\n  darkImage: string | null;\n  tabletImage: string | null;\n  darkTabletImage: string | null;\n}) {\n  const images = buildContentsJsonImages({ image, darkImage, tabletImage, darkTabletImage });\n\n  debug(`create contents.json:`, assetPath);\n  debug(`use images:`, images);\n  await writeContentsJsonAsync(assetPath, { images });\n}\n"],"file":"withIosSplashAssets.js"}
>>>>>>> 279c076d3cb6520341221d8adc510e9dbdcbb7c2
